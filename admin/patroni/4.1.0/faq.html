

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FAQ &mdash; Patroni 4.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="_static/github_style.css?v=1093691d" />
      <link rel="stylesheet" type="text/css" href="_static/custom.css?v=977c162b" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=42d1b3bd"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Release notes" href="releases.html" />
    <link rel="prev" title="HA multi datacenter" href="ha_multi_dc.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Patroni
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="README.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="patroni_configuration.html">Patroni configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="rest_api.html">Patroni REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="patronictl.html">patronictl</a></li>
<li class="toctree-l1"><a class="reference internal" href="replica_bootstrap.html">Replica imaging and bootstrap</a></li>
<li class="toctree-l1"><a class="reference internal" href="replication_modes.html">Replication modes</a></li>
<li class="toctree-l1"><a class="reference internal" href="standby_cluster.html">Standby cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="watchdog.html">Watchdog support</a></li>
<li class="toctree-l1"><a class="reference internal" href="pause.html">Pause/Resume mode for the cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="dcs_failsafe_mode.html">DCS Failsafe Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="kubernetes.html">Using Patroni with Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="citus.html">Citus support</a></li>
<li class="toctree-l1"><a class="reference internal" href="existing_data.html">Convert a Standalone to a Patroni Cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="existing_data.html#major-upgrade-of-postgresql-version">Major Upgrade of PostgreSQL Version</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools_integration.html">Integration with other tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="security.html">Security Considerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="ha_multi_dc.html">HA multi datacenter</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">FAQ</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#comparison-with-other-ha-solutions">Comparison with other HA solutions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dcs">DCS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#patronictl">patronictl</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#postgres-management">Postgres management</a></li>
<li class="toctree-l2"><a class="reference internal" href="#concepts-and-requirements">Concepts and requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#automatic-failover">Automatic failover</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bootstrapping-and-standbys-creation">Bootstrapping and standbys creation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#monitoring">Monitoring</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="releases.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="CONTRIBUTING.html">Contributing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Patroni</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">FAQ</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/patroni/patroni/blob/master/docs/faq.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="faq">
<span id="id1"></span><h1>FAQ<a class="headerlink" href="#faq" title="Link to this heading"></a></h1>
<p>In this section you will find answers for the most frequently asked questions about Patroni.
Each sub-section attempts to focus on different kinds of questions.</p>
<p>We hope that this helps you to clarify most of your questions.
If you still have further concerns or find yourself facing an unexpected issue, please refer to <a class="reference internal" href="contributing_guidelines.html#chatting"><span class="std std-ref">Chatting</span></a> and <a class="reference internal" href="contributing_guidelines.html#reporting-bugs"><span class="std std-ref">Reporting bugs</span></a> for instructions on how to get help or report issues.</p>
<section id="comparison-with-other-ha-solutions">
<h2>Comparison with other HA solutions<a class="headerlink" href="#comparison-with-other-ha-solutions" title="Link to this heading"></a></h2>
<dl>
<dt>Why does Patroni require a separate cluster of DCS nodes while other solutions like <code class="docutils literal notranslate"><span class="pre">repmgr</span></code> do not?</dt><dd><p>There are different ways of implementing HA solutions, each of them with their pros and cons.</p>
<p>Software like <code class="docutils literal notranslate"><span class="pre">repmgr</span></code> performs communication among the nodes to decide when actions should be taken.</p>
<p>Patroni on the other hand relies on the state stored in the DCS. The DCS acts as a source of truth for Patroni to decide what it should do.</p>
<p>While having a separate DCS cluster can make you bloat your architecture, this approach also makes it less likely for split-brain scenarios to happen in your Postgres cluster.</p>
</dd>
<dt>What is the difference between Patroni and other HA solutions in regards to Postgres management?</dt><dd><p>Patroni does not just manage the high availability of the Postgres cluster but also manages Postgres itself.</p>
<p>If Postgres nodes do not exist yet, it takes care of bootstrapping the primary and the standby nodes, and also manages Postgres configuration of the nodes. If the Postgres nodes already exist, Patroni will take over management of the cluster.</p>
<p>Besides the above, Patroni also has self-healing capabilities. In other words, if a primary node fails, Patroni will not only fail over to a replica, but also attempt to rejoin the former primary as a replica of the new primary. Similarly, if a replica fails, Patroni will attempt to rejoin that replica.</p>
<p>That is way we call Patroni as a “template for HA solutions”. It goes further than just managing physical replication: it manages Postgres as a whole.</p>
</dd>
</dl>
</section>
<section id="dcs">
<h2>DCS<a class="headerlink" href="#dcs" title="Link to this heading"></a></h2>
<dl>
<dt>Can I use the same <code class="docutils literal notranslate"><span class="pre">etcd</span></code> cluster to store data from two or more Patroni clusters?</dt><dd><p>Yes, you can!</p>
<p>Information about a Patroni cluster is stored in the DCS under a path prefixed with the <code class="docutils literal notranslate"><span class="pre">namespace</span></code> and <code class="docutils literal notranslate"><span class="pre">scope</span></code> Patroni settings.</p>
<p>As long as you do not have conflicting namespace and scope across different Patroni clusters, you should be able to use the same DCS cluster to store information from multiple Patroni clusters.</p>
</dd>
<dt>What occurs if I attempt to use the same combination of <code class="docutils literal notranslate"><span class="pre">namespace</span></code> and <code class="docutils literal notranslate"><span class="pre">scope</span></code> for different Patroni clusters that point to the same DCS cluster?</dt><dd><p>The second Patroni cluster that attempts to use the same <code class="docutils literal notranslate"><span class="pre">namespace</span></code> and <code class="docutils literal notranslate"><span class="pre">scope</span></code> will not be able to manage Postgres because it will find information related with that same combination in the DCS, but with an incompatible Postgres system identifier.
The mismatch on the system identifier causes Patroni to abort the management of the second cluster, as it assumes that refers to a different cluster and that the user has misconfigured Patroni.</p>
<p>Make sure to use different <code class="docutils literal notranslate"><span class="pre">namespace</span></code> / <code class="docutils literal notranslate"><span class="pre">scope</span></code> when dealing with different Patroni clusters that share the same DCS cluster.</p>
</dd>
<dt>What occurs if I lose my DCS cluster?</dt><dd><p>The DCS is used to store basically status and the dynamic configuration of the Patroni cluster.</p>
<p>They very first consequence is that all the Patroni clusters that rely on that DCS will go to read-only mode – unless <a class="reference internal" href="dcs_failsafe_mode.html#dcs-failsafe-mode"><span class="std std-ref">DCS Failsafe Mode</span></a> is enabled.</p>
</dd>
<dt>What should I do if I lose my DCS cluster?</dt><dd><p>There are three possible outcomes upon losing your DCS cluster:</p>
<ol class="arabic simple">
<li><p>The DCS cluster is fully recovered: this requires no action from the Patroni side. Once the DCS cluster is recovered, Patroni should be able to recover too;</p></li>
<li><p>The DCS cluster is re-created in place, and the endpoints remain the same. No changes are required on the Patroni side;</p></li>
<li><p>A new DCS cluster is created with different endpoints. You will need to update the DCS endpoints in the Patroni configuration of each Patroni node.</p></li>
</ol>
<p>If you face scenario <code class="docutils literal notranslate"><span class="pre">2.</span></code> or <code class="docutils literal notranslate"><span class="pre">3.</span></code> Patroni will take care of creating the status information again based on the current status of the cluster, and recreate the dynamic configuration on the DCS based on a backup file named <code class="docutils literal notranslate"><span class="pre">patroni.dynamic.json</span></code> which is stored inside the Postgres data directory of each member of the Patroni cluster.</p>
</dd>
<dt>What occurs if I lose majority in my DCS cluster?</dt><dd><p>The DCS will become unresponsive, which will cause Patroni to demote the current read/write Postgres node.</p>
<p>Remember: Patroni relies on the state of the DCS to take actions on the cluster.</p>
<p>You can use the <a class="reference internal" href="dcs_failsafe_mode.html#dcs-failsafe-mode"><span class="std std-ref">DCS Failsafe Mode</span></a> to alleviate that situation.</p>
</dd>
</dl>
</section>
<section id="patronictl">
<h2>patronictl<a class="headerlink" href="#patronictl" title="Link to this heading"></a></h2>
<dl>
<dt>Do I need to run <a class="reference internal" href="patronictl.html#patronictl"><span class="std std-ref">patronictl</span></a> in the Patroni host?</dt><dd><p>No, you do not need to do that.</p>
<p>Running <a class="reference internal" href="patronictl.html#patronictl"><span class="std std-ref">patronictl</span></a> in the Patroni host is handy if you have access to the Patroni host because you can use the very same configuration file from the <code class="docutils literal notranslate"><span class="pre">patroni</span></code> agent for the <a class="reference internal" href="patronictl.html#patronictl"><span class="std std-ref">patronictl</span></a> application.</p>
<p>However, <a class="reference internal" href="patronictl.html#patronictl"><span class="std std-ref">patronictl</span></a> is basically a client and it can be executed from remote machines. You just need to provide it with enough configuration so it can reach the DCS and the REST API of the Patroni member(s).</p>
</dd>
<dt>Why did the information from one of my Patroni members disappear from the output of <a class="reference internal" href="patronictl.html#patronictl-list"><span class="std std-ref">patronictl list</span></a> command?</dt><dd><p>Information shown by <a class="reference internal" href="patronictl.html#patronictl-list"><span class="std std-ref">patronictl list</span></a> is based on the contents of the DCS.</p>
<p>If information about a member disappeared from the DCS it is very likely that the Patroni agent on that node is not running anymore, or it is not able to communicate with the DCS.</p>
<p>As the member is not able to update the information, the information eventually expires from the DCS, and consequently the member is not shown anymore in the output of <a class="reference internal" href="patronictl.html#patronictl-list"><span class="std std-ref">patronictl list</span></a>.</p>
</dd>
<dt>Why is the information about one of my Patroni members not up-to-date in the output of <a class="reference internal" href="patronictl.html#patronictl-list"><span class="std std-ref">patronictl list</span></a> command?</dt><dd><p>Information shown by <a class="reference internal" href="patronictl.html#patronictl-list"><span class="std std-ref">patronictl list</span></a> is based on the contents of the DCS.</p>
<p>By default, that information is updated by Patroni roughly every <code class="docutils literal notranslate"><span class="pre">loop_wait</span></code> seconds.
In other words, even if everything is normally functional you may still see a “delay” of up to <code class="docutils literal notranslate"><span class="pre">loop_wait</span></code> seconds in the information stored in the DCS.</p>
<p>Be aware that that is not a rule, though. Some operations performed by Patroni cause it to immediately update the DCS information.</p>
</dd>
</dl>
</section>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Link to this heading"></a></h2>
<dl>
<dt>What is the difference between dynamic configuration and local configuration?</dt><dd><p>Dynamic configuration (or global configuration) is the configuration stored in the DCS, and which is applied to all members of the Patroni cluster.
This is primarily where you should store your configuration.</p>
<p>Settings that are specific to a node, or settings that you would like to overwrite the global configuration with, you should set only on the desired Patroni member as a local configuration.
That local configuration can be specified either through the configuration file or through environment variables.</p>
<p>See more in <a class="reference internal" href="patroni_configuration.html#patroni-configuration"><span class="std std-ref">Patroni configuration</span></a>.</p>
</dd>
<dt>What are the types of configuration in Patroni, and what is the precedence?</dt><dd><p>The types are:</p>
<ul class="simple">
<li><p>Dynamic configuration: applied to all members;</p></li>
<li><p>Local configuration: applied to the local member, overrides dynamic configuration;</p></li>
<li><p>Environment configuration: applied to the local member, overrides both dynamic and local configuration.</p></li>
</ul>
<p><strong>Note:</strong> some Postgres GUCs can only be set globally, i.e., through dynamic configuration. Besides that, there are GUCs which Patroni enforces a hard-coded value.</p>
<p>See more in <a class="reference internal" href="patroni_configuration.html#patroni-configuration"><span class="std std-ref">Patroni configuration</span></a>.</p>
</dd>
<dt>Is there any facility to help me create my Patroni configuration file?</dt><dd><p>Yes, there is.</p>
<p>You can use <code class="docutils literal notranslate"><span class="pre">patroni</span> <span class="pre">--generate-sample-config</span></code> or <code class="docutils literal notranslate"><span class="pre">patroni</span> <span class="pre">--generate-config</span></code> commands to generate a sample Patroni configuration or a Patroni configuration based on an existing Postgres instance, respectively.</p>
<p>Please refer to <a class="reference internal" href="patroni_configuration.html#generate-sample-config"><span class="std std-ref">Sample Patroni configuration</span></a> and <a class="reference internal" href="patroni_configuration.html#generate-config"><span class="std std-ref">Patroni configuration for a running instance</span></a> for more details.</p>
</dd>
<dt>I changed my parameters under <code class="docutils literal notranslate"><span class="pre">bootstrap.dcs</span></code> configuration but Patroni is not applying the changes to the cluster members. What is wrong?</dt><dd><p>The values configured under <code class="docutils literal notranslate"><span class="pre">bootstrap.dcs</span></code> are only used when bootstrapping a fresh cluster. Those values will be written to the DCS during the bootstrap.</p>
<p>After the bootstrap phase finishes, you will only be able to change the dynamic configuration through the DCS.</p>
<p>Refer to the next question for more details.</p>
</dd>
<dt>How can I change my dynamic configuration?</dt><dd><p>You need to change the configuration in the DCS. That is accomplished either through:</p>
<ul class="simple">
<li><p><a class="reference internal" href="patronictl.html#patronictl-edit-config"><span class="std std-ref">patronictl edit-config</span></a>; or</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">PATCH</span></code> request to <a class="reference internal" href="rest_api.html#config-endpoint"><span class="std std-ref">Config endpoint</span></a>.</p></li>
</ul>
</dd>
<dt>How can I change my local configuration?</dt><dd><p>You need to change the configuration file of the corresponding Patroni member and signal the Patroni agent with <code class="docutils literal notranslate"><span class="pre">SIHGUP</span></code>. You can do that using either of these approaches:</p>
<ul>
<li><p>Send a <code class="docutils literal notranslate"><span class="pre">POST</span></code> request to the REST API <a class="reference internal" href="rest_api.html#reload-endpoint"><span class="std std-ref">Reload endpoint</span></a>; or</p></li>
<li><p>Run <a class="reference internal" href="patronictl.html#patronictl-reload"><span class="std std-ref">patronictl reload</span></a>; or</p></li>
<li><p>Locally signal the Patroni process with <code class="docutils literal notranslate"><span class="pre">SIGHUP</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><p>If you started Patroni through systemd, you can use the command <code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">reload</span> <span class="pre">PATRONI_UNIT.service</span></code>, <code class="docutils literal notranslate"><span class="pre">PATRONI_UNIT</span></code> being the name of the Patroni service; or</p></li>
<li><p>If you started Patroni through other means, you will need to identify the <code class="docutils literal notranslate"><span class="pre">patroni</span></code> process and run <code class="docutils literal notranslate"><span class="pre">kill</span> <span class="pre">-s</span> <span class="pre">HUP</span> <span class="pre">PID</span></code>, <code class="docutils literal notranslate"><span class="pre">PID</span></code> being the process ID of the <code class="docutils literal notranslate"><span class="pre">patroni</span></code> process.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<p><strong>Note:</strong> there are cases where a reload through the <a class="reference internal" href="patronictl.html#patronictl-reload"><span class="std std-ref">patronictl reload</span></a> may not work:</p>
<ul class="simple">
<li><p>Expired REST API certificates: you can mitigate that by using the <code class="docutils literal notranslate"><span class="pre">-k</span></code> option of the <a class="reference internal" href="patronictl.html#patronictl"><span class="std std-ref">patronictl</span></a>;</p></li>
<li><p>Wrong credentials: for example when changing <code class="docutils literal notranslate"><span class="pre">restapi</span></code> or <code class="docutils literal notranslate"><span class="pre">ctl</span></code> credentials in the configuration file, and using that same configuration file for Patroni and <a class="reference internal" href="patronictl.html#patronictl"><span class="std std-ref">patronictl</span></a>.</p></li>
</ul>
</dd>
<dt>How can I change my environment configuration?</dt><dd><p>The environment configuration is only read by Patroni during startup.</p>
<p>With that in mind, if you change the environment configuration you will need to restart the corresponding Patroni agent.</p>
<p>Take care to not cause a failover in the cluster! You might be interested in checking <a class="reference internal" href="patronictl.html#patronictl-pause"><span class="std std-ref">patronictl pause</span></a>.</p>
</dd>
<dt>What occurs if I change a Postgres GUC that requires a reload?</dt><dd><p>When you change the dynamic or the local configuration as explained in the previous questions, Patroni will take care of reloading the Postgres configuration for you.</p>
</dd>
<dt>What occurs if I change a Postgres GUC that requires a restart?</dt><dd><p>Patroni will mark the affected members with a flag of <code class="docutils literal notranslate"><span class="pre">pending</span> <span class="pre">restart</span></code>.</p>
<p>It is up to you to determine when and how to restart the members. That can be accomplished either through:</p>
<ul class="simple">
<li><p><a class="reference internal" href="patronictl.html#patronictl-restart"><span class="std std-ref">patronictl restart</span></a>; or</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">POST</span></code> request to <a class="reference internal" href="rest_api.html#restart-endpoint"><span class="std std-ref">Restart endpoint</span></a>.</p></li>
</ul>
<p><strong>Note:</strong> some Postgres GUCs require a special management in terms of the order for restarting the Postgres nodes. Refer to <a class="reference internal" href="patroni_configuration.html#shared-memory-gucs"><span class="std std-ref">PostgreSQL parameters that touch shared memory</span></a> for more details.</p>
</dd>
<dt>What is the difference between <code class="docutils literal notranslate"><span class="pre">etcd</span></code> and <code class="docutils literal notranslate"><span class="pre">etcd3</span></code> in Patroni configuration?</dt><dd><p><code class="docutils literal notranslate"><span class="pre">etcd</span></code> uses the API version 2 of <code class="docutils literal notranslate"><span class="pre">etcd</span></code>, while <code class="docutils literal notranslate"><span class="pre">etcd3</span></code> uses the API version 3 of <code class="docutils literal notranslate"><span class="pre">etcd</span></code>.</p>
<p>Be aware that information stored by the API version 2 is not manageable by API version 3 and vice-versa.</p>
<p>We recommend that you configure <code class="docutils literal notranslate"><span class="pre">etcd3</span></code> instead of <code class="docutils literal notranslate"><span class="pre">etcd</span></code> because:</p>
<ul class="simple">
<li><p>API version 2 is disabled by default from Etcd v3.4 onward;</p></li>
<li><p>API version 2 will be completely removed on Etcd v3.6.</p></li>
</ul>
</dd>
<dt>I have <code class="docutils literal notranslate"><span class="pre">use_slots</span></code> enabled in my Patroni configuration, but when a cluster member goes offline for some time, the replication slot used by that member is dropped on the upstream node. What can I do to avoid that issue?</dt><dd><p>There are two options:</p>
<ol class="arabic simple">
<li><p>You can tune <code class="docutils literal notranslate"><span class="pre">member_slots_ttl</span></code> (default value <code class="docutils literal notranslate"><span class="pre">30min</span></code>, available since Patroni <code class="docutils literal notranslate"><span class="pre">4.0.0</span></code> and PostgreSQL 11 onwards) and replication slots for absent members will not be removed when the members downtime is shorter than the configured threshold.</p></li>
<li><p>You can configure permanent physical replication slots for the members.</p></li>
</ol>
<p>Since Patroni <code class="docutils literal notranslate"><span class="pre">3.2.0</span></code> it is now possible to have member slots as permanent slots managed by Patroni.</p>
<p>Patroni will create the permanent physical slots on all nodes, and make sure to not remove the slots, as well as to advance the slots’ LSN on all nodes according to the LSN that has been consumed by the member.</p>
<p>Later, if you decide to remove the corresponding member, it’s <strong>your responsibility</strong> to adjust the permanent slots configuration, otherwise Patroni will keep the slots around forever.</p>
<p><strong>Note:</strong> on Patroni older than <code class="docutils literal notranslate"><span class="pre">3.2.0</span></code> you could still have member slots configured as permanent physical slots, however they would be managed only on the current leader. That is, in case of failover/switchover these slots would be created on the new leader, but that wouldn’t guarantee that it had all WAL segments for the absent node.</p>
<p><strong>Note:</strong> even with Patroni <code class="docutils literal notranslate"><span class="pre">3.2.0</span></code> there might be a small race condition. In the very beginning, when the slot is created on the replica it could be ahead of the same slot on the leader and in case if nobody is consuming the slot there is still a chance that some files could be missing after failover. With that in mind, it is recommended that you configure continuous archiving, which makes it possible to restore required WALs or perform PITR.</p>
</dd>
<dt>What is the difference between <code class="docutils literal notranslate"><span class="pre">loop_wait</span></code>, <code class="docutils literal notranslate"><span class="pre">retry_timeout</span></code> and <code class="docutils literal notranslate"><span class="pre">ttl</span></code>?</dt><dd><p>Patroni performs what we call a HA cycle from time to time. On each HA cycle it takes care of performing a series of checks on the cluster to determine its healthiness, and depending on the status it may take actions, like failing over to a standby.</p>
<p><code class="docutils literal notranslate"><span class="pre">loop_wait</span></code> determines for how long, in seconds, Patroni should sleep before performing a new cycle of HA checks.</p>
<p><code class="docutils literal notranslate"><span class="pre">retry_timeout</span></code> sets the timeout for retry operations on the DCS and on Postgres. For example: if the DCS is unresponsive for more than <code class="docutils literal notranslate"><span class="pre">retry_timeout</span></code> seconds, Patroni might demote the primary node as a security action.</p>
<p><code class="docutils literal notranslate"><span class="pre">ttl</span></code> sets the lease time on the <code class="docutils literal notranslate"><span class="pre">leader</span></code> lock in the DCS. If the current leader of the cluster is not able to renew the lease during its HA cycles for longer than <code class="docutils literal notranslate"><span class="pre">ttl</span></code>, then the lease will expire and that will trigger a <code class="docutils literal notranslate"><span class="pre">leader</span> <span class="pre">race</span></code> in the cluster.</p>
<p><strong>Note:</strong> when modifying these settings, please keep in mind that Patroni enforces the rule and minimal values described in <a class="reference internal" href="dynamic_configuration.html#dynamic-configuration"><span class="std std-ref">Dynamic Configuration Settings</span></a> section of the docs.</p>
</dd>
</dl>
</section>
<section id="postgres-management">
<h2>Postgres management<a class="headerlink" href="#postgres-management" title="Link to this heading"></a></h2>
<dl>
<dt>Can I change Postgres GUCs directly in Postgres configuration?</dt><dd><p>You can, but you should avoid that.</p>
<p>Postgres configuration is managed by Patroni, and attempts to edit the configuration files may end up being frustrated by Patroni as it may eventually overwrite them.</p>
<p>There are a few options available to overcome the management performed by Patroni:</p>
<ul class="simple">
<li><p>Change Postgres GUCs through <code class="docutils literal notranslate"><span class="pre">$PGDATA/postgresql.base.conf</span></code>; or</p></li>
<li><p>Define a <code class="docutils literal notranslate"><span class="pre">postgresql.custom_conf</span></code> which will be used instead of <code class="docutils literal notranslate"><span class="pre">postgresql.base.conf</span></code> so you can manage that externally; or</p></li>
<li><p>Change GUCs using <code class="docutils literal notranslate"><span class="pre">ALTER</span> <span class="pre">SYSTEM</span></code> / <code class="docutils literal notranslate"><span class="pre">ALTER</span> <span class="pre">DATABASE</span></code> / <code class="docutils literal notranslate"><span class="pre">ALTER</span> <span class="pre">USER</span></code>.</p></li>
</ul>
<p>You can find more information about that in the section <a class="reference internal" href="patroni_configuration.html#important-configuration-rules"><span class="std std-ref">Important rules</span></a>.</p>
<p>In any case we recommend that you manage all the Postgres configuration through Patroni. That will centralize the management and make it easier to debug Patroni when needed.</p>
</dd>
<dt>Can I restart Postgres nodes directly?</dt><dd><p>No, you should <strong>not</strong> attempt to manage Postgres directly!</p>
<p>Any attempt of bouncing the Postgres server without Patroni can lead your cluster to face failovers.</p>
<p>If you need to manage the Postgres server, do that through the ways exposed by Patroni.</p>
</dd>
<dt>Is Patroni able to take over management of an already existing Postgres cluster?</dt><dd><p>Yes, it can!</p>
<p>Please refer to <a class="reference internal" href="existing_data.html#existing-data"><span class="std std-ref">Convert a Standalone to a Patroni Cluster</span></a> for detailed instructions.</p>
</dd>
<dt>How does Patroni manage Postgres?</dt><dd><p>Patroni takes care of bringing Postgres up and down by running the Postgres binaries, like <code class="docutils literal notranslate"><span class="pre">pg_ctl</span></code> and <code class="docutils literal notranslate"><span class="pre">postgres</span></code>.</p>
<p>With that in mind you <strong>MUST</strong> disable any other sources that could manage the Postgres clusters, like the systemd units, e.g. <code class="docutils literal notranslate"><span class="pre">postgresql.service</span></code>. Only Patroni should be able to start, stop and promote Postgres instances in the cluster. Not doing so may result in split-brain scenarios. For example: if the node running as a primary failed and the unit <code class="docutils literal notranslate"><span class="pre">postgresql.service</span></code> is enabled, it may bring Postgres back up and cause a split-brain.</p>
</dd>
</dl>
</section>
<section id="concepts-and-requirements">
<h2>Concepts and requirements<a class="headerlink" href="#concepts-and-requirements" title="Link to this heading"></a></h2>
<dl>
<dt>Which are the applications that make part of Patroni?</dt><dd><p>Patroni basically ships a couple applications:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">patroni</span></code>: This is the Patroni agent, which takes care of managing a Postgres node;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">patronictl</span></code>: This is a command-line utility used to interact with a Patroni cluster (perform switchovers, restarts, changes in the configuration, etc.). Please find more information in <a class="reference internal" href="patronictl.html#patronictl"><span class="std std-ref">patronictl</span></a>.</p></li>
</ul>
</dd>
<dt>What is a <code class="docutils literal notranslate"><span class="pre">standby</span> <span class="pre">cluster</span></code> in Patroni?</dt><dd><p>It is a cluster that does not have any primary Postgres node running, i.e., there is no read/write member in the cluster.</p>
<p>These kinds of clusters exist to replicate data from another cluster and are usually useful when you want to replicate data across data centers.</p>
<p>There will be a leader in the cluster which will be a standby in charge of replicating changes from a remote Postgres node.
Then, there will be a set of standbys configured with cascading replication from such leader member.</p>
<p><strong>Note:</strong> the standby cluster doesn’t know anything about the source cluster which it is replicating from – it can even use <code class="docutils literal notranslate"><span class="pre">restore_command</span></code> instead of WAL streaming, and may use an absolutely independent DCS cluster.</p>
<p>Refer to <a class="reference internal" href="standby_cluster.html#standby-cluster"><span class="std std-ref">Standby cluster</span></a> for more details.</p>
</dd>
<dt>What is a <code class="docutils literal notranslate"><span class="pre">leader</span></code> in Patroni?</dt><dd><p>A <code class="docutils literal notranslate"><span class="pre">leader</span></code> in Patroni is like a coordinator of the cluster.</p>
<p>In a regular Patroni cluster, the <code class="docutils literal notranslate"><span class="pre">leader</span></code> will be the read/write node.</p>
<p>In a standby Patroni cluster, the <code class="docutils literal notranslate"><span class="pre">leader</span></code> (AKA <code class="docutils literal notranslate"><span class="pre">standby</span> <span class="pre">leader</span></code>) will be in charge of replicating from a remote Postgres node, and cascading those changes to the other members of the standby cluster.</p>
</dd>
<dt>Does Patroni require a minimum number of Postgres nodes in the cluster?</dt><dd><p>No, you can run Patroni with any number of Postgres nodes.</p>
<p>Remember: Patroni is decoupled from the DCS.</p>
</dd>
<dt>What does <code class="docutils literal notranslate"><span class="pre">pause</span></code> mean in Patroni?</dt><dd><p>Pause is an operation exposed by Patroni so the user can ask Patroni to step back in regards to Postgres management.</p>
<p>That is mainly useful when you want to perform maintenance on the cluster, and would like to avoid that Patroni takes decisions related with HA, like failing over to a standby when you stop the primary.</p>
<p>You can find more information about that in <a class="reference internal" href="pause.html#pause"><span class="std std-ref">Pause/Resume mode for the cluster</span></a>.</p>
</dd>
</dl>
</section>
<section id="automatic-failover">
<h2>Automatic failover<a class="headerlink" href="#automatic-failover" title="Link to this heading"></a></h2>
<dl>
<dt>How does the automatic failover mechanism of Patroni work?</dt><dd><p>Patroni automatic failover is based on what we call <code class="docutils literal notranslate"><span class="pre">leader</span> <span class="pre">race</span></code>.</p>
<p>Patroni stores the cluster’s status in the DCS, among them a <code class="docutils literal notranslate"><span class="pre">leader</span></code> lock which holds the name of the Patroni member which is the current <code class="docutils literal notranslate"><span class="pre">leader</span></code> of the cluster.</p>
<p>That <code class="docutils literal notranslate"><span class="pre">leader</span></code> lock has a time-to-live associated with it. If the leader node fails to update the lease of the <code class="docutils literal notranslate"><span class="pre">leader</span></code> lock in time, the key will eventually expire from the DCS.</p>
<p>When the <code class="docutils literal notranslate"><span class="pre">leader</span></code> lock expires, it triggers what Patroni calls a <code class="docutils literal notranslate"><span class="pre">leader</span> <span class="pre">race</span></code>: all nodes start performing checks to determine if they are the best candidates for taking over the <code class="docutils literal notranslate"><span class="pre">leader</span></code> role.
Some of these checks include calls to the REST API of all other Patroni members.</p>
<p>All Patroni members that find themselves as the best candidate for taking over the <code class="docutils literal notranslate"><span class="pre">leader</span></code> lock will attempt to do so.
The first Patroni member that is able to take the <code class="docutils literal notranslate"><span class="pre">leader</span></code> lock will promote itself to a read/write node (or <code class="docutils literal notranslate"><span class="pre">standby</span> <span class="pre">leader</span></code>), and the others will be configured to follow it.</p>
</dd>
<dt>Can I temporarily disable automatic failover in the Patroni cluster?</dt><dd><p>Yes, you can!</p>
<p>You can achieve that by temporarily pausing the cluster.
This is typically useful for performing maintenance.</p>
<p>When you want to resume the automatic failover of the cluster, you just need to unpause it.</p>
<p>You can find more information about that in <a class="reference internal" href="pause.html#pause"><span class="std std-ref">Pause/Resume mode for the cluster</span></a>.</p>
</dd>
</dl>
</section>
<section id="bootstrapping-and-standbys-creation">
<h2>Bootstrapping and standbys creation<a class="headerlink" href="#bootstrapping-and-standbys-creation" title="Link to this heading"></a></h2>
<dl>
<dt>How does Patroni create a primary Postgres node? What about a standby Postgres node?</dt><dd><p>By default Patroni will use <code class="docutils literal notranslate"><span class="pre">initdb</span></code> to bootstrap a fresh cluster, and <code class="docutils literal notranslate"><span class="pre">pg_basebackup</span></code> to create standby nodes from a copy of the <code class="docutils literal notranslate"><span class="pre">leader</span></code> member.</p>
<p>You can customize that behavior by writing your custom bootstrap methods, and your custom replica creation methods.</p>
<p>Custom methods are usually useful when you want to restore backups created by backup tools like pgBackRest or Barman, for example.</p>
<p>For detailed information please refer to <a class="reference internal" href="replica_bootstrap.html#custom-bootstrap"><span class="std std-ref">Bootstrap</span></a> and <a class="reference internal" href="replica_bootstrap.html#custom-replica-creation"><span class="std std-ref">Building replicas</span></a>.</p>
</dd>
</dl>
</section>
<section id="monitoring">
<h2>Monitoring<a class="headerlink" href="#monitoring" title="Link to this heading"></a></h2>
<dl>
<dt>How can I monitor my Patroni cluster?</dt><dd><p>Patroni exposes a couple handy endpoints in its <a class="reference internal" href="rest_api.html#rest-api"><span class="std std-ref">Patroni REST API</span></a>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/metrics</span></code>: exposes monitoring metrics in a format that can be consumed by Prometheus;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/patroni</span></code>: exposes the status of the cluster in a JSON format. The information shown here is very similar to what is shown by the <code class="docutils literal notranslate"><span class="pre">/metrics</span></code> endpoint.</p></li>
</ul>
<p>You can use those endpoints to implement monitoring checks.</p>
</dd>
</dl>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="ha_multi_dc.html" class="btn btn-neutral float-left" title="HA multi datacenter" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="releases.html" class="btn btn-neutral float-right" title="Release notes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025 Compose, Zalando SE, Patroni Contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>