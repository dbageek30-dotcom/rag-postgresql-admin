

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Standby cluster &mdash; Patroni 4.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="_static/github_style.css?v=1093691d" />
      <link rel="stylesheet" type="text/css" href="_static/custom.css?v=977c162b" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=42d1b3bd"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Watchdog support" href="watchdog.html" />
    <link rel="prev" title="Replication modes" href="replication_modes.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Patroni
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="README.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="patroni_configuration.html">Patroni configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="rest_api.html">Patroni REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="patronictl.html">patronictl</a></li>
<li class="toctree-l1"><a class="reference internal" href="replica_bootstrap.html">Replica imaging and bootstrap</a></li>
<li class="toctree-l1"><a class="reference internal" href="replication_modes.html">Replication modes</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Standby cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="watchdog.html">Watchdog support</a></li>
<li class="toctree-l1"><a class="reference internal" href="pause.html">Pause/Resume mode for the cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="dcs_failsafe_mode.html">DCS Failsafe Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="kubernetes.html">Using Patroni with Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="citus.html">Citus support</a></li>
<li class="toctree-l1"><a class="reference internal" href="existing_data.html">Convert a Standalone to a Patroni Cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="existing_data.html#major-upgrade-of-postgresql-version">Major Upgrade of PostgreSQL Version</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools_integration.html">Integration with other tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="security.html">Security Considerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="ha_multi_dc.html">HA multi datacenter</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="releases.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="CONTRIBUTING.html">Contributing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Patroni</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Standby cluster</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/patroni/patroni/blob/master/docs/standby_cluster.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="standby-cluster">
<span id="id1"></span><h1>Standby cluster<a class="headerlink" href="#standby-cluster" title="Link to this heading"></a></h1>
<p>Patroni also support running cascading replication to a remote datacenter
(region) using a feature that is called “standby cluster”. This type of
clusters has:</p>
<ul class="simple">
<li><p>“standby leader”, that behaves pretty much like a regular cluster leader,
except it replicates from a remote node.</p></li>
<li><p>cascade replicas, that are replicating from standby leader.</p></li>
</ul>
<p>Standby leader holds and updates a leader lock in DCS. If the leader lock
expires, cascade replicas will perform an election to choose another leader
from the standbys.</p>
<p>There is no further relationship between the standby cluster and the primary
cluster it replicates from, in particular, they must not share the same DCS
scope if they use the same DCS. They do not know anything else from each other
apart from replication information. Also, the standby cluster is not being
displayed in <a class="reference internal" href="patronictl.html#patronictl-list"><span class="std std-ref">patronictl list</span></a> or <a class="reference internal" href="patronictl.html#patronictl-topology"><span class="std std-ref">patronictl topology</span></a> output on the
primary cluster.</p>
<p>For the sake of flexibility, you can specify methods of creating a replica and
recovery WAL records when a cluster is in the “standby mode” by providing
<a class="reference internal" href="replica_bootstrap.html#custom-replica-creation"><span class="std std-ref">create_replica_methods</span></a> key in
<cite>standby_cluster</cite> section. It is distinct from creating replicas, when cluster
is detached and functions as a normal cluster, which is controlled by
<cite>create_replica_methods</cite> in <cite>postgresql</cite> section. Both “standby” and “normal”
<cite>create_replica_methods</cite> reference  keys in <cite>postgresql</cite> section.</p>
<p>To configure such cluster you need to specify the section <code class="docutils literal notranslate"><span class="pre">standby_cluster</span></code>
in a patroni configuration:</p>
<div class="highlight-YAML notranslate"><div class="highlight"><pre><span></span><span class="nt">bootstrap</span><span class="p">:</span>
<span class="w">    </span><span class="nt">dcs</span><span class="p">:</span>
<span class="w">        </span><span class="nt">standby_cluster</span><span class="p">:</span>
<span class="w">            </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.2.3.4</span>
<span class="w">            </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5432</span>
<span class="w">            </span><span class="nt">primary_slot_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">patroni</span>
<span class="w">            </span><span class="nt">create_replica_methods</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">basebackup</span>
</pre></div>
</div>
<p>Note, that these options will be applied only once during cluster bootstrap,
and the only way to change them afterwards is through DCS.</p>
<p>Patroni expects to find <cite>postgresql.conf</cite> or <cite>postgresql.conf.backup</cite> in PGDATA
of the remote primary and will not start if it does not find it after a
basebackup. If the remote primary keeps its <cite>postgresql.conf</cite> elsewhere, it is
your responsibility to copy it to PGDATA.</p>
<p>If you use replication slots on the standby cluster, you must also create the
corresponding replication slot on the primary cluster.  It will not be done
automatically by the standby cluster implementation.  You can use Patroni’s
permanent replication slots feature on the primary cluster to maintain a
replication slot with the same name as <code class="docutils literal notranslate"><span class="pre">primary_slot_name</span></code>, or its default
value if <code class="docutils literal notranslate"><span class="pre">primary_slot_name</span></code> is not provided.</p>
<p>In case the remote site doesn’t provide a single endpoint that connects to a
primary, one could list all hosts of the source cluster in the
<code class="docutils literal notranslate"><span class="pre">standby_cluster.host</span></code> section.  When <code class="docutils literal notranslate"><span class="pre">standby_cluster.host</span></code> contains
multiple hosts separated by commas, Patroni will:</p>
<ul class="simple">
<li><p>add <code class="docutils literal notranslate"><span class="pre">target_session_attrs=read-write</span></code> to the <code class="docutils literal notranslate"><span class="pre">primary_conninfo</span></code> on the
standby leader node.</p></li>
<li><p>use <code class="docutils literal notranslate"><span class="pre">target_session_attrs=read-write</span></code> when trying to determine whether we
need to run <code class="docutils literal notranslate"><span class="pre">pg_rewind</span></code> or when executing <code class="docutils literal notranslate"><span class="pre">pg_rewind</span></code> on all nodes of the
standby cluster.</p></li>
<li><p>It is important to note that for <code class="docutils literal notranslate"><span class="pre">pg_rewind</span></code> to operate successfully,
either the cluster must be initialized with <code class="docutils literal notranslate"><span class="pre">data</span> <span class="pre">page</span> <span class="pre">checksums</span></code>
(<code class="docutils literal notranslate"><span class="pre">--data-checksums</span></code> option for <code class="docutils literal notranslate"><span class="pre">initdb</span></code>) and/or <code class="docutils literal notranslate"><span class="pre">wal_log_hints</span></code> must be set to <code class="docutils literal notranslate"><span class="pre">on</span></code>.
Otherwise, <code class="docutils literal notranslate"><span class="pre">pg_rewind</span></code> will not function properly.</p></li>
</ul>
<p>There is also a possibility to replicate the standby cluster from another
standby cluster or from a standby member of the primary cluster: for that, you
need to define a single host in the <code class="docutils literal notranslate"><span class="pre">standby_cluster.host</span></code> section. However,
you need to beware that in this case <code class="docutils literal notranslate"><span class="pre">pg_rewind</span></code> will fail to execute on the
standby cluster.</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="replication_modes.html" class="btn btn-neutral float-left" title="Replication modes" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="watchdog.html" class="btn btn-neutral float-right" title="Watchdog support" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025 Compose, Zalando SE, Patroni Contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>