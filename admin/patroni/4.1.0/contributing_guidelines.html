

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Contributing guidelines &mdash; Patroni 4.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="_static/github_style.css?v=1093691d" />
      <link rel="stylesheet" type="text/css" href="_static/custom.css?v=977c162b" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=42d1b3bd"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="patroni" href="modules/modules.html" />
    <link rel="prev" title="Contributing" href="CONTRIBUTING.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Patroni
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="README.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="patroni_configuration.html">Patroni configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="rest_api.html">Patroni REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="patronictl.html">patronictl</a></li>
<li class="toctree-l1"><a class="reference internal" href="replica_bootstrap.html">Replica imaging and bootstrap</a></li>
<li class="toctree-l1"><a class="reference internal" href="replication_modes.html">Replication modes</a></li>
<li class="toctree-l1"><a class="reference internal" href="standby_cluster.html">Standby cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="watchdog.html">Watchdog support</a></li>
<li class="toctree-l1"><a class="reference internal" href="pause.html">Pause/Resume mode for the cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="dcs_failsafe_mode.html">DCS Failsafe Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="kubernetes.html">Using Patroni with Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="citus.html">Citus support</a></li>
<li class="toctree-l1"><a class="reference internal" href="existing_data.html">Convert a Standalone to a Patroni Cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="existing_data.html#major-upgrade-of-postgresql-version">Major Upgrade of PostgreSQL Version</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools_integration.html">Integration with other tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="security.html">Security Considerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="ha_multi_dc.html">HA multi datacenter</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="releases.html">Release notes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="CONTRIBUTING.html">Contributing</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Contributing guidelines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#chatting">Chatting</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reporting-bugs">Reporting bugs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-tests">Running tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="#testing-with-tox">Testing with tox</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#running-tox">Running tox</a></li>
<li class="toctree-l4"><a class="reference internal" href="#behave-tests">Behave tests</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#contributing-a-pull-request">Contributing a pull request</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="modules/modules.html">Patroni API docs</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Patroni</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="CONTRIBUTING.html">Contributing</a></li>
      <li class="breadcrumb-item active">Contributing guidelines</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/patroni/patroni/blob/master/docs/contributing_guidelines.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="contributing-guidelines">
<span id="id1"></span><h1>Contributing guidelines<a class="headerlink" href="#contributing-guidelines" title="Link to this heading"></a></h1>
<section id="chatting">
<span id="id2"></span><h2>Chatting<a class="headerlink" href="#chatting" title="Link to this heading"></a></h2>
<p>If you have a question, looking for an interactive troubleshooting help or want to chat with other Patroni users, join us on channel <a class="reference external" href="https://postgresteam.slack.com/archives/C9XPYG92A">#patroni</a> in the <a class="reference external" href="https://pgtreats.info/slack-invite">PostgreSQL Slack</a>.</p>
</section>
<section id="reporting-bugs">
<span id="id3"></span><h2>Reporting bugs<a class="headerlink" href="#reporting-bugs" title="Link to this heading"></a></h2>
<p>Before reporting a bug please make sure to <strong>reproduce it with the latest Patroni version</strong>!
Also please double check if the issue already exists in our <a class="reference external" href="https://github.com/patroni/patroni/issues">Issues Tracker</a>.</p>
</section>
<section id="running-tests">
<h2>Running tests<a class="headerlink" href="#running-tests" title="Link to this heading"></a></h2>
<p>Requirements for running behave tests:</p>
<ol class="arabic simple">
<li><p>PostgreSQL packages including <a class="reference external" href="https://www.postgresql.org/docs/current/contrib.html">contrib</a> modules need to be installed.</p></li>
<li><p>PostgreSQL binaries must be available in your <cite>PATH</cite>. You may need to add them to the path with something like <cite>PATH=/usr/lib/postgresql/11/bin:$PATH python -m behave</cite>.</p></li>
<li><p>If you’d like to test with external DCSs (e.g., Etcd, Consul, and Zookeeper) you’ll need the packages installed and respective services running and accepting unencrypted/unprotected connections on localhost and default port. In the case of Etcd or Consul, the behave test suite could start them up if binaries are available in the <cite>PATH</cite>.</p></li>
</ol>
<p>Install dependencies:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># You may want to use Virtualenv or specify pip3.</span>
pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt
pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.dev.txt
</pre></div>
</div>
<p>After you have all dependencies installed, you can run the various test suites:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># You may want to use Virtualenv or specify python3.</span>

<span class="c1"># Run flake8 to check syntax and formatting:</span>
python<span class="w"> </span>setup.py<span class="w"> </span>flake8

<span class="c1"># Run the pytest suite in tests/:</span>
python<span class="w"> </span>setup.py<span class="w"> </span><span class="nb">test</span>

<span class="c1"># Moreover, you may want to run tests in different scopes for debugging purposes,</span>
<span class="c1"># the -s option include print output during test execution.</span>
<span class="c1"># Tests in pytest typically follow the pattern: FILEPATH::CLASSNAME::TESTNAME.</span>
pytest<span class="w"> </span>-s<span class="w"> </span>tests/test_api.py
pytest<span class="w"> </span>-s<span class="w"> </span>tests/test_api.py::TestRestApiHandler
pytest<span class="w"> </span>-s<span class="w"> </span>tests/test_api.py::TestRestApiHandler::test_do_GET

<span class="c1"># Run the behave (https://behave.readthedocs.io/en/latest/) test suite in features/;</span>
<span class="c1"># modify DCS as desired (raft has no dependencies so is the easiest to start with):</span>
<span class="nv">DCS</span><span class="o">=</span>raft<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>behave
</pre></div>
</div>
</section>
<section id="testing-with-tox">
<h2>Testing with tox<a class="headerlink" href="#testing-with-tox" title="Link to this heading"></a></h2>
<p>To run tox tests you only need to install one dependency (other than Python)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>tox&gt;<span class="o">=</span><span class="m">4</span>
</pre></div>
</div>
<p>If you wish to run <cite>behave</cite> tests then you also need docker installed.</p>
<p>Tox configuration in <cite>tox.ini</cite> has “environments” to run the following tasks:</p>
<ul class="simple">
<li><p>lint: Python code lint with <cite>flake8</cite></p></li>
<li><p>test: unit tests for all available python interpreters with <cite>pytest</cite>,
generates XML reports or HTML reports if a TTY is detected</p></li>
<li><p>dep: detect package dependency conflicts using <cite>pipdeptree</cite></p></li>
<li><p>type: static type checking with <cite>pyright</cite></p></li>
<li><p>black: code formatting with <cite>black</cite></p></li>
<li><p>docker-build: build docker image used for the <cite>behave</cite> env</p></li>
<li><p>docker-cmd: run arbitrary command with the above image</p></li>
<li><p>docker-behave-etcd: run tox for behave tests with above image</p></li>
<li><p>py*behave: run behave with available python interpreters (without docker, although
this is what is called inside docker containers)</p></li>
<li><p>docs: build docs with <cite>sphinx</cite></p></li>
</ul>
<section id="running-tox">
<h3>Running tox<a class="headerlink" href="#running-tox" title="Link to this heading"></a></h3>
<p>To run the default env list; dep, lint, test, and docs, just run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tox
</pre></div>
</div>
<p>The <cite>test</cite> envs can be run with the label <cite>test</cite>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tox<span class="w"> </span>-m<span class="w"> </span><span class="nb">test</span>
</pre></div>
</div>
<p>The <cite>behave</cite> docker tests can be run with the label <cite>behave</cite>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tox<span class="w"> </span>-m<span class="w"> </span>behave
</pre></div>
</div>
<p>Similarly, docs has the label <cite>docs</cite>.</p>
<p>All other envs can be run with their respective env names:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tox<span class="w"> </span>-e<span class="w"> </span>lint
tox<span class="w"> </span>-e<span class="w"> </span>py39-test-lin
</pre></div>
</div>
<p>It is also possible to select partial env lists using <cite>factors</cite>. For example, if you want to run
all envs for python 3.10:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tox<span class="w"> </span>-f<span class="w"> </span>py310
</pre></div>
</div>
<p>This is equivalent to running all the envs listed below:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>tox<span class="w"> </span>-l<span class="w"> </span>-f<span class="w"> </span>py310
py310-test-lin
py310-test-mac
py310-test-win
py310-type-lin
py310-type-mac
py310-type-win
py310-behave-etcd-lin
py310-behave-etcd-win
py310-behave-etcd-mac
</pre></div>
</div>
<p>You can list all configured combinations of environments with tox (&gt;=v4) like so</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tox<span class="w"> </span>l
</pre></div>
</div>
<p>The envs <cite>test</cite> and <cite>docs</cite> will attempt to open the HTML output files
when the job completes, if tox is run with an active terminal. This
is intended to be for benefit of the developer running this env locally.
It will attempt to run <cite>open</cite> on a mac and <cite>xdg-open</cite> on Linux.
To use a different command set the env var <cite>OPEN_CMD</cite> to the name or path of
the command. If this step fails it will not fail the run overall.
If you want to disable this facility set the env var <cite>OPEN_CMD</cite> to the <cite>:</cite> no-op command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">OPEN_CMD</span><span class="o">=</span>:<span class="w"> </span>tox<span class="w"> </span>-m<span class="w"> </span>docs
</pre></div>
</div>
</section>
<section id="behave-tests">
<h3>Behave tests<a class="headerlink" href="#behave-tests" title="Link to this heading"></a></h3>
<p>Behave tests with <cite>-m behave</cite> will build docker images based on PG_MAJOR version 11 through 16 and then run all
behave tests. This can take quite a long time to run so you might want to limit the scope to a select version of
Postgres or to a specific feature set or steps.</p>
<p>To specify the version of postgres include the full name of the dependent image build env that you want and then the
behave env name. For instance if you want Postgres 14 use:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tox<span class="w"> </span>-e<span class="w"> </span>pg14-docker-build,pg14-docker-behave-etcd-lin
</pre></div>
</div>
<p>If on the other hand you want to test a specific feature you can pass positional arguments to behave. This will run
the watchdog behave feature test scenario with all versions of Postgres.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tox<span class="w"> </span>-m<span class="w"> </span>behave<span class="w"> </span>--<span class="w"> </span>features/watchdog.feature
</pre></div>
</div>
<p>Of course you can combine the two.</p>
</section>
</section>
<section id="contributing-a-pull-request">
<h2>Contributing a pull request<a class="headerlink" href="#contributing-a-pull-request" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p>Fork the repository, develop and test your code changes.</p></li>
<li><p>Reflect changes in the user documentation.</p></li>
<li><p>Submit a pull request with a clear description of the changes objective. Link an existing issue if necessary.</p></li>
</ol>
<p>You’ll get feedback about your pull request as soon as possible.</p>
<p>Happy Patroni hacking ;-)</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="CONTRIBUTING.html" class="btn btn-neutral float-left" title="Contributing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="modules/modules.html" class="btn btn-neutral float-right" title="patroni" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025 Compose, Zalando SE, Patroni Contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>